name: EC2 Control Tower (On/Off)

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'ì›í•˜ëŠ” ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”'
        required: true
        default: 'start'
        type: choice
        options:
          - start
          - stop

jobs:
  manage-ec2:
    runs-on: ubuntu-latest
    steps:
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}     # ê¸°ì¡´ì— ë“±ë¡í•œ ì‹œí¬ë¦¿ ì‚¬ìš©
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} # ê¸°ì¡´ì— ë“±ë¡í•œ ì‹œí¬ë¦¿ ì‚¬ìš©
          aws-region: ap-northeast-2

      - name: Execute EC2 Command
        run: |
          INSTANCE_ID="i-09dbf2e335d3749d0" 
          
          if [ "${{ inputs.action }}" == "start" ]; then
            echo "ğŸš€ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
            aws ec2 start-instances --instance-ids $INSTANCE_ID
            echo "âœ… ì‹œì‘ ëª…ë ¹ ì „ì†¡ ì™„ë£Œ! (ì™„ì „íˆ ì¼œì§€ëŠ” ë° 1~2ë¶„ ê±¸ë¦½ë‹ˆë‹¤)"
          else
            echo "ğŸ›‘ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì •ì§€í•©ë‹ˆë‹¤..."
            aws ec2 stop-instances --instance-ids $INSTANCE_ID
            echo "âœ… ì •ì§€ ëª…ë ¹ ì „ì†¡ ì™„ë£Œ!"
          fi